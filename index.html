<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>二〇二六年・本格八百万おみくじ</title>
    <style>
        body {
            font-family: "Hiragino Mincho ProN", "serif";
            background-color: #fdf5e6;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }
        .container {
            background-color: white;
            width: 92%;
            max-width: 480px;
            padding: 20px;
            border: 5px double #d32f2f;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            text-align: center;
            overflow: hidden; 
        }
        h1 { color: #d32f2f; border-bottom: 2px solid #d32f2f; padding-bottom: 10px; margin-top: 0; font-size: 1.5rem; }
        
        /* 選択画面 */
        .selection-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 20px;
        }
        .omikuji-stick {
            background-color: #e0c38c;
            color: #5d4037;
            padding: 12px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            transition: 0.2s;
            border: 2px solid #bca67e;
            user-select: none;
            font-size: 1.1rem;
        }
        @media (hover: none) {
            .omikuji-stick:active {
                transform: scale(0.95);
                background-color: #d32f2f;
                color: white;
            }
        }

        /* 鑑定中演出 */
        .loading-text {
            font-size: 1.5rem; color: #d32f2f; font-weight: bold; margin: 80px 0 20px 0;
            animation: pulse 1.2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.7; }
        }

        /* 結果表示のアニメーション */
        #result-scroll-box {
            clip-path: inset(0 0 100% 0);
        }
        .scroll-animation {
            animation: scrollOpen 4s ease-in-out forwards; /* 項目が増えたので少し時間を長く */
        }
        @keyframes scrollOpen {
            0% { clip-path: inset(0 0 100% 0); }
            100% { clip-path: inset(0 0 0 0); }
        }

        /* 結果のデザイン */
        .rank { font-size: 3.2rem; font-weight: bold; color: #d32f2f; margin: 15px 0 10px 0; letter-spacing: 8px; }
        
        .year-summary {
            background-color: #fffaf0;
            border: 1px solid #e0c38c;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 5px;
            font-weight: bold;
            color: #333;
            line-height: 1.6;
            font-size: 0.95rem;
        }
        .summary-title {
            display: block;
            color: #d32f2f;
            font-size: 0.8rem;
            margin-bottom: 5px;
            border-bottom: 1px solid #d32f2f;
            width: fit-content;
            margin: 0 auto 5px auto;
        }

        .details-grid { text-align: left; border-top: 1px solid #eee; padding-top: 15px; }
        .detail-item { 
            border-bottom: 1px dashed #eee; 
            padding: 6px 0; 
            display: flex;
            align-items: flex-start;
            font-size: 0.88rem;
            line-height: 1.5;
        }
        .label { 
            font-weight: bold; 
            color: #d32f2f; 
            min-width: 5.5em; /* 漢数字3文字分＋αの幅を確保 */
            display: inline-block;
        }

        .hidden { display: none; }
        #back-button { opacity: 0; transition: opacity 1s; }
        .fade-in { opacity: 1 !important; }
        
        button.primary-btn {
            background-color: #d32f2f; color: white; border: none; padding: 12px 30px;
            font-size: 1.1rem; cursor: pointer; border-radius: 5px; font-family: inherit;
        }
        button.secondary-btn {
            margin-top: 20px; background-color: #555; color: white; border: none; padding: 12px 30px;
            font-size: 1rem; cursor: pointer; border-radius: 5px; font-family: inherit;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>二〇二六年 御神籤</h1>

    <div id="intro-screen">
        <p style="margin: 30px 0;">新たな一年の運勢を<br>お選びください。</p>
        <button class="primary-btn" onclick="startSelection()">おみくじを振る</button>
    </div>

    <div id="selection-screen" class="hidden">
        <p>直感で一本お選びください</p>
        <div class="selection-grid" id="stick-container"></div>
    </div>

    <div id="loading-screen" class="hidden">
        <div class="loading-text">鑑定中...</div>
        <p>二〇二六年の運命を読み解いています</p>
    </div>

    <div id="result-screen" class="hidden">
        <div id="result-scroll-box">
            <div class="rank" id="rank-display"></div>
            
            <div class="year-summary">
                <span class="summary-title">二〇二六年 概況</span>
                <span id="summary-text"></span>
            </div>

            <div class="details-grid" id="details-display"></div>
        </div>
        <button id="back-button" class="secondary-btn" onclick="resetApp()">最初に戻る</button>
    </div>
</div>

<script>
    const weightedRanks = [
        { name: "大吉", weight: 15 }, { name: "吉", weight: 15 },
        { name: "中吉", weight: 20 }, { name: "小吉", weight: 20 },
        { name: "末吉", weight: 20 }, { name: "凶", weight: 5 },
        { name: "大凶", weight: 5 }
    ];

    const kanjiNumbers = ["一", "二", "三", "四", "五", "六", "七", "八", "九", "十"];

    const yearSummaries = {
        "大吉": "これまでの努力が大きな実を結ぶ、輝かしい一年。新たな挑戦はすべて追い風となります。自信を持って前へ進んでください。",
        "吉": "安定した運気に包まれ、穏やかに過ごせる一年。周囲への感謝を形にすることで、さらに運気が上昇します。",
        "中吉": "公私ともに充実した年になります。特に人間関係で実りがありそう。丁寧なコミュニケーションを心がけましょう。",
        "小吉": "大きな波乱はなく、一歩ずつ着実に成長できる年。派手さはありませんが、足元を固めるには最適な時期です。",
        "末吉": "前半は忍耐が必要ですが、後半にかけて徐々に運気が開けます。焦らず、準備を整えることに注力してください。",
        "凶": "慎重さが求められる年。無理な拡張は避け、現状維持と心身のケアを優先しましょう。誠実に過ごせば難を逃れます。",
        "大凶": "試練の年となる予感。しかし、これは飛躍に向けたデトックスの時期。古いものを手放すことで、新しい運気が入り込みます。"
    };

    const commentPool = {
        "願い事": ["時間はかかるが必ず叶う。", "驚くほど順調に進む。感謝せよ。", "今は控えめが吉。時を待て。", "他人の助けで成就する。"],
        "待ち人": ["来る。驚くような便りあり。", "遅れるが必ず来る。", "来るが期待外れのことあり。", "来ない。便りを待て。"],
        "失し物": ["出る。高い所にあり。", "遅れて見つかる。焦るな。", "出ない。諦めが肝心。", "近い所にあり。よく探せ。"],
        "旅行": ["北の方角に吉あり。", "計画をしっかり立てて行け。", "控えよ。来年が良し。", "行き先で良い出会いあり。"],
        "ビジネス": ["利益あり。自信を持って進め。", "苦労するが後に報われる。", "計画を再検討せよ。独断は禁物。", "誠実な対応が成功を呼ぶ。"],
        "学問": ["努力が実る。油断するな。", "基礎を固めよ。道が開ける。", "誘惑に勝て。集中力が鍵。", "安心して励め。結果は出る。"],
        "争い事": ["勝つ。しかし後に引くな。", "負ける。今は引くのが吉。", "話し合いで円満に解決する。", "長引く。冷静さを保て。"],
        "恋愛": ["誠実な心が縁を結ぶ。", "良い出会いあり。自分を磨け。", "焦るな。自然な流れに任せよ。", "相手を思いやる心が鍵。"],
        "縁談": ["まとまる。親類に相談せよ。", "時期を待て。焦ると損をする。", "良い話あり。前向きに考えよ。", "今は控えめに。縁が薄い。"],
        "転居": ["吉。急ぐ必要はない。", "良い場所が見つかる。北が良し。", "今は留まれ。時期ではない。", "方角を確かめよ。東が吉。"],
        "病気": ["軽んじるな。必ず治る。", "信心せよ。回復に向かう。", "長引くが安心して養生せよ。", "早期の対応が肝要なり。"]
    };

    function startSelection() {
        document.getElementById('intro-screen').classList.add('hidden');
        document.getElementById('selection-screen').classList.remove('hidden');
        const container = document.getElementById('stick-container');
        container.innerHTML = '';
        for (let i = 0; i < 10; i++) {
            const stick = document.createElement('div');
            stick.className = 'omikuji-stick';
            stick.textContent = `第${kanjiNumbers[i]}番`;
            stick.onclick = processResult;
            container.appendChild(stick);
        }
    }

    let isProcessing = false;
    function processResult() {
        if (isProcessing) return;
        isProcessing = true;
        document.getElementById('selection-screen').classList.add('hidden');
        document.getElementById('loading-screen').classList.remove('hidden');
        setTimeout(() => {
            showFinalResult();
            isProcessing = false;
        }, 2200);
    }

    function getWeightedRank() {
        let randomNum = Math.random() * 100;
        for (const r of weightedRanks) {
            if (randomNum < r.weight) return r.name;
            randomNum -= r.weight;
        }
        return "吉";
    }

    function showFinalResult() {
        const rank = getWeightedRank();
        document.getElementById('rank-display').textContent = rank;
        document.getElementById('summary-text').textContent = yearSummaries[rank];

        let html = "";
        for (let category in commentPool) {
            const list = commentPool[category];
            const comment = list[Math.floor(Math.random() * list.length)];
            html += `
                <div class="detail-item">
                    <span class="label">【${category}】</span>
                    <span class="text">${comment}</span>
                </div>
            `;
        }
        document.getElementById('details-display').innerHTML = html;

        document.getElementById('loading-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');

        const scrollBox = document.getElementById('result-scroll-box');
        const backButton = document.getElementById('back-button');
        
        scrollBox.classList.remove('scroll-animation');
        backButton.classList.remove('fade-in');
        void scrollBox.offsetWidth; 
        scrollBox.classList.add('scroll-animation');

        setTimeout(() => {
            backButton.classList.add('fade-in');
        }, 4000); // 項目数に合わせて待ち時間を4秒に延長
    }

    function resetApp() {
        document.getElementById('result-screen').classList.add('hidden');
        document.getElementById('intro-screen').classList.remove('hidden');
    }
</script>

</body>
</html>
