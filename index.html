<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>本格・選べる八百万おみくじ</title>
    <style>
        body {
            font-family: "Hiragino Mincho ProN", "serif";
            background-color: #fdf5e6;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            /* スマホでのタップハイライトを無効化 */
            -webkit-tap-highlight-color: transparent;
        }
        .container {
            background-color: white;
            width: 90%;
            max-width: 450px;
            padding: 25px;
            border: 5px double #d32f2f;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            text-align: center;
            /* はみ出した部分を隠す */
            overflow: hidden; 
        }
        h1 { color: #d32f2f; border-bottom: 2px solid #d32f2f; padding-bottom: 10px; margin-top: 0; }
        
        /* 選択画面 */
        .selection-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .omikuji-stick {
            background-color: #e0c38c;
            color: #5d4037;
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            transition: 0.2s;
            border: 2px solid #bca67e;
            user-select: none; /* 文字選択を防ぐ */
        }
        /* スマホでのタッチ時の挙動 */
        @media (hover: none) {
            .omikuji-stick:active {
                transform: scale(0.9);
                background-color: #d32f2f;
                color: white;
            }
        }
        /* PCでのホバー時の挙動 */
        @media (hover: hover) {
            .omikuji-stick:hover {
                transform: translateY(-3px);
                box-shadow: 2px 5px 10px rgba(0,0,0,0.3);
            }
        }

        /* 鑑定中（待ち時間）の演出 */
        .loading-text {
            font-size: 1.5rem; color: #d32f2f; font-weight: bold; margin: 50px 0;
            animation: pulse 1.2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.7; }
        }

        /* --- 結果表示のアニメーション --- */
        /* アニメーションさせる範囲のラッパー */
        #result-scroll-box {
            /* 初期状態：下側を100%切り抜いて隠す */
            clip-path: inset(0 0 100% 0);
        }
        /* このクラスが付くとアニメーション開始 */
        .scroll-animation {
            animation: scrollOpen 2.5s ease-in-out forwards;
        }
        /* 上から下へ開く動きの定義 */
        @keyframes scrollOpen {
            0% { clip-path: inset(0 0 100% 0); }
            100% { clip-path: inset(0 0 0 0); } /* 切り抜きなし＝全表示 */
        }

        /* 後から出るボタン */
        #back-button {
            opacity: 0; /* 最初は透明 */
            transition: opacity 1s;
        }
        /* このクラスが付くとふわっと現れる */
        .fade-in {
            opacity: 1 !important;
        }

        /* 結果の中身 */
        .rank { font-size: 3.5rem; font-weight: bold; color: #d32f2f; margin: 20px 0; }
        .details-grid { text-align: left; border-top: 1px solid #eee; padding-top: 20px; padding-bottom: 10px; }
        .detail-item { border-bottom: 1px dashed #eee; padding-bottom: 8px; margin-bottom: 8px; font-size: 0.95rem; line-height: 1.6; }
        .label { font-weight: bold; color: #d32f2f; margin-right: 8px; white-space: nowrap; }

        .hidden { display: none; }
        button.primary-btn {
            background-color: #d32f2f; color: white; border: none; padding: 12px 30px;
            font-size: 1.1rem; cursor: pointer; border-radius: 5px; font-family: inherit;
            -webkit-tap-highlight-color: transparent;
        }
        button.secondary-btn {
            margin-top: 20px; background-color: #555; color: white; border: none; padding: 12px 30px;
            font-size: 1rem; cursor: pointer; border-radius: 5px; font-family: inherit;
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>御神籤</h1>

    <div id="intro-screen">
        <p style="margin: 30px 0;">心を静め、<br>運命の一本をお選びください。</p>
        <button class="primary-btn" onclick="startSelection()">おみくじを振る</button>
    </div>

    <div id="selection-screen" class="hidden">
        <p>いずれか一つをタップしてください</p>
        <div class="selection-grid" id="stick-container"></div>
    </div>

    <div id="loading-screen" class="hidden">
        <div class="loading-text" style="margin-top: 80px;">鑑定中...</div>
        <p>そのままお待ちください</p>
    </div>

    <div id="result-screen" class="hidden">
        <div id="result-scroll-box">
            <div class="rank" id="rank-display"></div>
            <div class="details-grid" id="details-display"></div>
        </div>
        <button id="back-button" class="secondary-btn" onclick="resetApp()">最初に戻る</button>
    </div>
</div>

<script>
    const weightedRanks = [
        { name: "大吉", weight: 15 }, { name: "吉", weight: 15 },
        { name: "中吉", weight: 20 }, { name: "小吉", weight: 20 },
        { name: "末吉", weight: 20 }, { name: "凶", weight: 5 },
        { name: "大凶", weight: 5 }
    ];

    // コメントのプール（自由に増やしてください）
    const commentPool = {
        "願望": ["時を待てば必ず叶う。", "驚くほど順調に進む。", "今は控えめが吉。", "他人の助けで成就する。", "焦ると損をする。"],
        "恋愛": ["誠実な心が縁を結ぶ。", "ゆっくりと愛を育め。", "予期せぬ良縁あり。", "自分磨きが鍵となる。", "相手の気持ちを考えよ。"],
        "仕事": ["地道な努力が評価される。", "新たな分野に挑戦せよ。", "周囲との協調を大切に。", "全体を見渡す余裕を持て。", "準備不足に注意。"],
        "金運": ["無駄を省けば蓄財できる。", "思わぬ臨時収入の予感。", "今は財布の紐を締めよ。", "計画的な運用が吉。", "甘い話には乗るな。"],
        "健康": ["規則正しい生活を心がけよ。", "十分な休息が必要。", "適度な運動を取り入れよ。", "旬の食材が体に良い。", "ストレスを溜めるな。"],
        "学問": ["日々の積み重ねが実を結ぶ。", "基礎を疎かにするな。", "集中できる環境を作れ。", "苦手を克服する好機。", "目標を高く持て。"],
        "旅行": ["北の方角に吉あり。", "計画をしっかり立てよ。", "近場でのんびりが良い。", "旅先での出会いを大切に。", "忘れ物に注意。"],
        "失物": ["身近な場所にある。", "探すのを止めると出る。", "高い所を探してみよ。", "人目につかない所にある。", "すぐには見つからぬ。"]
    };

    function startSelection() {
        document.getElementById('intro-screen').classList.add('hidden');
        document.getElementById('selection-screen').classList.remove('hidden');
        const container = document.getElementById('stick-container');
        container.innerHTML = '';
        for (let i = 1; i <= 10; i++) {
            const stick = document.createElement('div');
            stick.className = 'omikuji-stick';
            stick.textContent = `${i}`;
            // タッチデバイスでの反応を良くするため touchstart も設定
            stick.addEventListener('touchstart', function(e){ e.preventDefault(); processResult(); }, {passive: false});
            stick.addEventListener('click', processResult);
            container.appendChild(stick);
        }
    }

    let isProcessing = false; // 多重タップ防止

    function processResult() {
        if (isProcessing) return;
        isProcessing = true;

        document.getElementById('selection-screen').classList.add('hidden');
        document.getElementById('loading-screen').classList.remove('hidden');

        // 2秒間の鑑定中演出
        setTimeout(() => {
            showFinalResult();
            isProcessing = false;
        }, 2000);
    }

    function getWeightedRank() {
        let randomNum = Math.random() * 100;
        for (const r of weightedRanks) {
            if (randomNum < r.weight) return r.name;
            randomNum -= r.weight;
        }
        return "吉";
    }

    function showFinalResult() {
        // 結果の生成処理
        const rank = getWeightedRank();
        document.getElementById('rank-display').textContent = rank;
        let html = "";
        // カテゴリをランダムに5つ選んで表示する（全表示だと長いので）
        const categories = Object.keys(commentPool).sort(() => 0.5 - Math.random()).slice(0, 5);
        for (let category of categories) {
            const list = commentPool[category];
            const comment = list[Math.floor(Math.random() * list.length)];
            html += `<div class="detail-item"><span class="label">【${category}】</span>${comment}</div>`;
        }
        document.getElementById('details-display').innerHTML = html;

        // 画面切り替え
        document.getElementById('loading-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');

        // --- アニメーションの開始処理 ---
        const scrollBox = document.getElementById('result-scroll-box');
        const backButton = document.getElementById('back-button');
        
        // アニメーション用クラスをリセット（強制再描画）
        scrollBox.classList.remove('scroll-animation');
        backButton.classList.remove('fade-in');
        void scrollBox.offsetWidth; // ブラウザにリフローを強制させるハック

        // アニメーション開始
        scrollBox.classList.add('scroll-animation');

        // おみくじが開く時間（2.5秒）待ってからボタンを表示
        setTimeout(() => {
            backButton.classList.add('fade-in');
        }, 2500);
    }

    function resetApp() {
        // 状態をリセット
        document.getElementById('result-scroll-box').classList.remove('scroll-animation');
        document.getElementById('back-button').classList.remove('fade-in');
        document.getElementById('result-screen').classList.add('hidden');
        document.getElementById('intro-screen').classList.remove('hidden');
    }
</script>

</body>
</html>
